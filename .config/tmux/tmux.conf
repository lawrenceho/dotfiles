# Use CTRL-A as prefix
unbind C-b
set-option -g prefix C-a
bind C-a send-prefix

# Use vi keys in copy mode
set-option -g mode-keys vi

# Use emacs keys in status line
set-option -g status-keys emacs

# Use lower escape time (from Neovim checkhealth)
set-option -g escape-time 10

# Use focus events (from Neovim checkhealth)
set-option -g focus-events on

# Mouse support
set-option -g mouse on

# History size
set-option -g history-limit 10000

# Status update interval
set-option -g status-interval 1

# Monitor activities and bells
set-option -g monitor-activity on
set-option -g monitor-bell on

# Use number 1 for the first window
set-option -g base-index 1

# Renumber windows automatically
set-option -g renumber-windows on

# Window separator
set-option -g window-status-separator ''

# True colour
# https://github.com/tmux/tmux/wiki/FAQ#how-do-i-use-rgb-colour
set-option -as terminal-overrides ',*256color:Tc'

# Undercurl
# Use overrides as detection of terminal capabilities may not work well
# Windows Terminal requires specifc color sequence
# https://github.com/tmux/tmux/issues/3769
set-option -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set-option -as terminal-overrides ',*:Setulc=\E[58::2::::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Colours
# https://github.com/folke/tokyonight.nvim/blob/main/extras/tmux/tokyonight_night.tmux
set-option -g @bg_blue '#273356'
set-option -g @bg_dark '#16161e'
set-option -g @bg '#1a1b26'
set-option -g @bg_highlight '#292e42'
set-option -g @fg_dark '#a9b1d6'
set-option -g @fg_gutter '#3b4261'
set-option -g @blue0 '#3d59a1'
set-option -g @blue '#7aa2f7'
set-option -g @magenta '#bb9af7'
set-option -g @orange '#ff9e64'
set-option -g @yellow '#e0af68'
set-option -g @green2 '#41a6b5'
set-option -g @red '#f7768e'

# Mode colours
set-option -Fg mode-style 'bg=#{@bg_blue},fg=#{@fg_dark}'

# Status colours
set-option -Fg status-style 'bg=#{@bg_dark},fg=#{@blue}'

# Window status colours
set-option -Fg window-status-style 'bg=#{@bg},fg=#{@fg_dark}'

# Status colours for windows with activity
set-option -Fg window-status-activity-style 'bg=#{@orange},fg=#{@bg_dark}'

# Status colours for windows with bells
set-option -Fg window-status-bell-style 'bg=#{@red},fg=#{@bg_dark}'

# Active window status colours
set-option -Fg window-status-current-style 'bg=#{@bg_highlight},fg=#{@fg_dark}'

# Message
set-option -Fg message-style 'fg=#{@fg_dark}'

# Pane border
set-option -Fg pane-active-border-style 'fg=#{@blue}'
set-option -Fg pane-border-style 'fg=#{@fg_gutter}'

# Status style
set-option -Fg @mode_style '#[bg=#{@blue} fg=#{@bg_dark}]'
set-option -Fg @prefix_style '#[bg=#{@yellow} fg=#{@bg_dark}]'
set-option -Fg @selection_style '#[bg=#{@magenta} fg=#{@bg_dark}]'
set-option -Fg @mode_alt_style '#[bg=#{@fg_gutter} fg=#{@blue}]'
set-option -Fg @prefix_alt_style '#[bg=#{@fg_gutter} fg=#{@yellow}]'
set-option -Fg @selection_alt_style '#[bg=#{@fg_gutter} fg=#{@magenta}]'

# Status format
set-option -g status-left '#[bold]#{?client_prefix,#{@prefix_style} PREFIX,\
#{?selection_active,#{@selection_style} #{?rectangle_toggle,S-RECT,SELECT},\
#{?pane_in_mode,#{@mode_style} #(printf #{s|([a-z]*)-mode|\1|:pane_mode} | tr [:lower:] [:upper:]),\
#{@mode_style} TERMINAL}}} '
set-option -g status-right '#{?client_prefix,#{@prefix_alt_style},\
#{?selection_active,#{@selection_alt_style},\
#{?pane_in_mode,#{@mode_alt_style},\
#{@mode_alt_style}}}} #{session_name} \
#[bold]#{?client_prefix,#{@prefix_style},\
#{?selection_active,#{@selection_style},\
#{?pane_in_mode,#{@mode_style},\
#{@mode_style}}}} %a %b %-d %-I:%M %p '

# Window status format
set-option -g window-status-current-format '#{?window_zoomed_flag,#[bold],} #{window_index}:#{window_name}\
#{?#{>:#{window_panes},1},:#{pane_index},} '
set-option -g window-status-format '#{?window_zoomed_flag,#[bold],} #{window_index}:#{window_name} '

# Copy mode highlighting
%if '#{>=:#{version},3.2}'
set-option -Fg copy-mode-match-style 'bg=#{@blue0}'
set-option -Fg copy-mode-current-match-style 'bg=#{@orange},fg=#{@bg_dark}'
%endif
